<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <title>44 懒狗计算器</title>
    <script src="js/vue.js"></script>
</head>

<body>
    <div class="main">
        <div class="enemy">
            <div v-for="item in enemyList" :key="item.key" class="enemyList" :style="item.style">
                <img v-if="item.character === enemyParty.leader" width="32px" height="32px"
                    src="./pic/ui/ic_crown_red.png.png" style="position:absolute;left:-16px;top:-16px;z-index:1"></img>
                <img :width="item.imgWidth" :height="item.imgHeight" :src="item.image"
                    style="position:absolute;left:0px;top:0px;z-index:0" @click="clickCard(item)"></img>
            </div>
            <div v-for="item in enemyParty.member" :key="item.key" class="enemyParty" :style="item.EPStyle">
                <img v-if="item === enemyParty.leader" width="32px" height="32px" src="./pic/ui/ic_crown_red.png.png"
                    style="position:absolute;left:-16px;top:-16px;z-index:1"></img>
                <img :width="item.EPImgWidth" :height="item.EPImgHeight" :src="item.image"
                    style="position:absolute;left:0px;top:0px;z-index:0"></img>
                <img v-if="item !== enemyParty.leader" width="65px" height="65px" src="./pic/ui/arrow.png"
                    style="position:absolute;left:0px;top:65px;z-index:1"
                    @click="modifyEP(enemyParty.member,item)"></img>
            </div>
        </div>
        <div class="calc">
            <div v-for="item in calcList" :key="item.key" class="calcList" :style="item.style">
                <img v-if="item.character === calcParty.leader" width="32px" height="32px"
                    src="./pic/ui/ic_crown_blue.png.png" style="position:absolute;left:-16px;top:-16px;z-index:1"></img>
                <img :width="item.imgWidth" :height="item.imgHeight" :src="item.image"
                    style="position:absolute;left:0px;top:0px;z-index:0" @click="clickCalc(item)"></img>
            </div>
            <div v-if="showCalcParty === 1">
                <div v-for="item in calcParty.member" :key="item.key" class="calcParty" :style="item.CPStyle">
                    <img v-if="item === calcParty.leader" width="32px" height="32px"
                        src="./pic/ui/ic_crown_blue.png.png"
                        style="position:absolute;left:-16px;top:-16px;z-index:1"></img>
                    <img v-if="item.CPStyle.left!='115px' && item !== calcParty.leader" width="65px" height="65px"
                        src="./pic/ui/arrow.png" style="position:absolute;left:0px;top:65px;z-index:1"
                        @click="modifyCP(calcParty.member,item)"></img>
                    <img :width="item.CPImgWidth" :height="item.CPImgHeight" :src="item.image"
                        style="position:absolute;left:0px;top:0px;z-index:0" @click="clickSP(item)"
                        :style="item.calcStyle"></img>
                </div>
            </div>
        </div>
        <div v-if="isEnemyCs === 1" class="enemyCs">
            <div v-for="item in elementFilters" :key="item.key" class="elementFilter" :style="item.style">
                <img :src="item.image" :style="item.imgStyle" @click="clickElementFilter(item)"></img>
            </div>
            <div v-for="item in character" :key="item.key" class="enemyCsList" :style="item.ECsStyle">
                <div v-if="item.ECsFiltered === 1">
                    <img :width="item.ECsImgWidth" :height="item.ECsImgHeight" :src="item.image"
                        @click="clickECs(item)"></img>
                </div>
            </div>
        </div>
        <div v-if="showSolution === 1" class="solutions">
            <div v-for="item in solutions" :key="item.key" class="solutions">
                <div v-for="citem in item.party" :key="citem.key" :style="citem.style" class="solutions">
                    <img v-if="citem.style.left==='50px'" width="32px" height="32px"
                        src="./pic/ui/ic_crown_blue.png.png"
                        style="position:absolute;left:-16px;top:-16px;z-index:1"></img>
                    <button v-if="citem.style.left==='50px'" class="calcButton" @click="chooseCalc(item)"
                        style="position:absolute;left:275px">选择</button>
                    <img :width="citem.character.SImgWidth" :height="citem.character.SImgHeight"
                        :src="citem.character.image"></img>
                </div>
            </div>
        </div>
        <div v-if="showSolution === 0" class="equipment">
            <div v-for="item in calcParty.member" :key="item.key" class="equipment">
                <div v-for="citem in item.equipment" :key="citem.key" :style="citem.style" class="equipment">
                    <img :src="citem.image"></img>
                </div>
            </div>
        </div>
        <div class="arrow">
            <svg width="1200" height="600">
                <line v-for="item in arrowList" :key="item.key" :x1="item.y1" :y1="item.x1" :x2="item.y2" :y2="item.x2"
                    :style="item.style"></line>
            </svg>
        </div>
        <div style="position:absolute;left:315px;top:370px">
            <button @click="calc()" class="calcButton">计算</button>
        </div>
        <div style="position:absolute;left:720px;top:235px">
            <button @click="resetEnemy()" class="calcButton">重置</button>
        </div>
        <div style="position:absolute;left:715px;top:30px">
            <b>坎公 44 懒狗计算器</b>（ver 1.3.0, by <a href="https://space.bilibili.com/500388576">crystal302</a>）更新至菲伦版本<br>
            （<a href="https://www.bilibili.com/video/BV1vH4y137WY">点我查看操作说明</a>）
            （<a href="https://www.wjx.top/vm/wkgkI2q.aspx">点我反馈问题</a>）<br>
            <img src="https://badges.toozhao.com/badges/01HY255VTGE08VQZ8XAB1F24F9/blue.svg" /><br>
            <a style="color:red">{{errorInfo}}</a>
            <a style="color:green">{{succInfo}}</a>
        </div>
    </div>
</body>
<script type="module">
    const height = 65;
    const width = 65;
    const offset = 50;
    const enemyLeftOffset = 400;
    class Character {
        constructor({ id, name, nick, element, weapon, ai, type, shield, disable }) {
            this.id = id;
            this.name = name;
            this.nick = nick;
            this.element = element;
            this.weapon = weapon;
            this.ai = ai;
            this.type = type;
            this.shield = shield;
            this.disable = disable;
            if (this.id === 0) this.image = "./pic/portraits/empty_1.png";
            else this.image = "./pic/portraits/" + name + ".png";
            /* Style for Enemy Choose */
            this.ECsImgHeight = 60;
            this.ECsImgWidth = 60;
            this.CPImgHeight = 60;
            this.CPImgWidth = 60;
            this.SImgHeight = 60;
            this.SImgWidth = 60;
            this.ECsy = 0;
            this.ECsx = 0;
            this.ECsFiltered = 0;
            this.ECsStyle = {}
            this.EPImgHeight = 60;
            this.EPImgWidth = 60;
            this.EPStyle = {};
            this.CPStyle = {};
            this.calcStyle = {
                position: "absolute",
                "z-index": 0,
                opacity: 1,
            }
        }
        filter(rule, id) {
            this.ECsFiltered = 0;
            if (rule.ban === 1) return 0;
            if (this.disable === 1) return 0;
            if (this.id !== 0 && rule.element !== "" && this.element !== rule.element) return 0;
            this.ECsy = Math.floor(id / 10);
            this.ECsx = id % 10;
            this.ECsFiltered = 1;
            this.ECsStyle = {
                top: (this.ECsy + 6) * height + offset + "px",
                left: this.ECsx * width + enemyLeftOffset + offset + "px",
                width: width + "px",
                height: height + "px",
            }
            return 1;
        }
    };
    class Party {
        constructor() {
            this.member = [];
            this.leader = null;
        }
        addMember(item, side) {
            let len = this.member.length;
            if (side === 1) {
                item.EPStyle = {};
                item.EPImgHeight = 60;
                item.EPImgWidth = 60;
            } else {
                item.CPStyle = {};
                item.CPImgHeight = 60;
                item.CPImgWidth = 60;
            }
            this.member.push(item);
        }
        refresh(side) {
            for (let i = 0; i < this.member.length; ++i) {
                if (side === 1) {
                    this.member[i].EPStyle = {
                        top: 4 * height + offset + "px",
                        left: (i + 5) * width + enemyLeftOffset + "px",
                        width: width + "px",
                        height: height + "px",
                    }
                } else {
                    this.member[i].CPStyle = {
                        top: 5 * height + offset + "px",
                        left: i * width + offset + "px",
                        width: width + "px",
                        height: height + "px",
                    }
                }
            }
        }
    }
    class Tile {
        setCharacter(c, side = 1) {
            this.character = c;
            this.image = c.image;
            this.side = side;
            if (c.id === 0) {
                this.image = "./pic/portraits/empty_" + side + ".png";
            } else this.image = c.image;
        }
        constructor({ side, x, y, c }) {
            this.imgHeight = 60;
            this.imgWidth = 60;
            this.side = side;
            this.x = x;
            this.y = y;
            this.style = {
                top: y * height + offset + "px",
                left: x * width + offset + side * enemyLeftOffset + "px",
                width: height + "px",
                height: width + "px",
                opacity: 1,
            };
            this.character = c;
            if (c.id === 0) {
                this.image = "./pic/portraits/empty_" + side + ".png";
            } else this.image = c.image;
        }
    };
    class ElementFilter {
        constructor({ id, name, color }) {
            this.id = id;
            this.name = name;
            this.color = color;
            this.image = "./pic/ui/ic_attribute_" + name + ".png.png";
            this.imgHeight = 60;
            this.imgWidth = 60;
            this.style = {
                top: 5 * height + offset + "px",
                left: this.id * width + enemyLeftOffset + offset + "px",
                width: width + "px",
                height: height + "px",
                opacity: 1,
            }
            this.imgStyle = {
                "background-color": this.color,
                width: this.imgWidth + "px",
                height: this.imgHeight + "px",
            }
        }
    }
    const boardWidth = 4;
    const boardHeight = 5;
    new Vue({
        el: ".main",
        data: {
            enemyList: [],
            enemyMap: [],
            calcList: [],
            calcMap: [],
            errorInfo: "",
            succInfo: "",
            solutions: [],
            showSolution: 0,
            elementFilters_: [
                { name: "no", color: "grey" },
                { name: "dark", color: "purple" },
                { name: "light", color: "yellow" },
                { name: "ground", color: "brown" },
                { name: "water", color: "blue" },
                { name: "fire", color: "red" },
            ],
            elementFilters: [],
            character_: [
                // ai: 1 近战 2 远程 3 锁射手 4 锁辅助 5 支援 6 暗萝 7 火奶 8 锁战士
                // type: 1 战士 2 射手 3 辅助 4 坦克
                { name: "empty", nick: "", element: "", ai: 0, type: 0, weapon: "" },
                { name: "tanker_ascent", nick: "craig", element: "ground", ai: 1, type: 4, weapon: "tanker", shield: 1 },
                { name: "tanker_ascent", nick: "craig_noshield", element: "ground", ai: 1, type: 4, disable:1, weapon: "", shield: 1 },
                { name: "vampire_noble_ascent", nick: "karina", element: "dark", ai: 2, type: 3, weapon: "vampirenoble" },
                { name: "invader_knight", nick: "beth", element: "dark", ai: 3, type: 1 },
                { name: "witch_coco", nick: "lupina", element: "dark", ai: 1, type: 1 },
                { name: "plague_doctor", nick: "kaden", element: "dark", ai: 1, type: 1 },
                { name: "sunyeo", nick: "dabin", element: "ground", ai: 2, type: 2 },
                { name: "forest_elf", nick: "estel", element: "ground", ai: 1, type: 1 },
                { name: "watcher", nick: "yuna", element: "ground", ai: 2, type: 0 },
                { name: "future_princess", nick: "fprincess", element: "light", ai: 1, type: 4, shield: 1 },
                { name: "knight_female_ascent", nick: "knight", element: "no", ai: 1, type: 1, weapon: "knight" },
                { name: "dokkaebi", nick: "eunha", element: "no", ai: 2, type: 2 },
                { name: "surfer_sohee", nick: "sohee", element: "no", ai: 3, type: 1 },
                { name: "blue_dragon", nick: "yun", element: "water", ai: 2, type: 3 },
                { name: "parvati", nick: "parvati", element: "ground", ai: 4, type: 1 },
                { name: "dragon_daughter", nick: "ameris", element: "ground", ai: 2, type: 2 },
                { name: "mermaid", nick: "sia", element: "water", ai: 2, type: 3 },
                { name: "fallen_queen", nick: "camilla", element: "dark", ai: 1, type: 2 },
                { name: "festival_girl", nick: "miya", element: "fire", ai: 7, type: 3 },
                { name: "innuit_ascent", nick: "coco", element: "water", ai: 2, type: 2, weapon: "innuit" },
                { name: "guardian_angel", nick: "angie", element: "water", ai: 4, type: 1 },
                { name: "mecha_android", nick: "mk99", element: "light", ai: 2, type: 2 },
                { name: "demon_powergirl", nick: "paimond", element: "fire", ai: 1, type: 4 },
                { name: "sea_witch", nick: "ara", element: "water", ai: 2, type: 3 },
                { name: "slime_shuna", nick: "shuna", element: "fire", ai: 2, type: 3 },
                { name: "demon_slayer", nick: "andras", element: "water", ai: 2, type: 2 },
                { name: "priestess", nick: "veronica", element: "water", ai: 1, type: 3 },
                { name: "hero_ai", nick: "kai", element: "light", ai: 1, type: 1 },
                { name: "eleanor", nick: "eleanor", element: "light", ai: 2, type: 3 },
                { name: "necromancer", nick: "noxia", element: "dark", ai: 6, type: 3 },
                { name: "exorcist_girl", nick: "saya", element: "fire", ai: 8, type: 1 },
                { name: "shuran", nick: "winling", element: "fire", ai: 5, type: 1 },
                { name: "store_angel", nick: "gabriel", element: "light", ai: 2, type: 3 },
                { name: "kamael", nick: "kamael", element: "ground", ai: 2, type: 3 },
                { name: "vampire_captain", nick: "valencia", element: "light", ai: 2, type: 1 },
                { name: "lina", nick: "lina", element: "fire", ai: 1, type: 2 },
                { name: "half_vampire", nick: "priscilla", element: "light", ai: 2, type: 2 },
                { name: "half_vampire", nick: "priscilla-bari", element: "ground", ai: 2, type: 2, weapon: "flowergirl", disable: 1 },
                { name: "robot_tanker", nick: "oghma", element: "dark", ai: 1 /*default as weapon 1*/, type: 4, shield: 1 },
                { name: "future_knight", nick: "fknight", element: "no", ai: 2, type: 2 },
                { name: "alpaca_girl", nick: "mayreel", element: "ground", ai: 1, type: 3 },
                { name: "rudolph", nick: "rue", element: "ground", ai: 3, type: 1 },
                { name: "rudolph", nick: "rue2", element: "ground", ai: 1, type: 1, disable: 1, weapon: "rudolph2" },
                { name: "china_hero_boy_ascent", nick: "fei", element: "light", ai: 1, type: 1, weapon: "china" },
                { name: "uptown_lancer_girl", nick: "lapice", element: "light", ai: 1 /*default as weapon 2*/, type: 1 },
                { name: "vampire_lord", nick: "claude", element: "dark", ai: 2, type: 2 },
                { name: "villain_redhood", nick: "arabelle", element: "dark", ai: 2, type: 2 },
                { name: "demon_ceo", nick: "lilith", element: "dark", ai: 1, type: 1 },
                { name: "demon_engineer", nick: "vinette", element: "dark", ai: 2, type: 3 },
                { name: "desertelf_hunter", nick: "rosetta", element: "ground", ai: 2, type: 2 },
                { name: "legendary_hero", nick: "erina", element: "no", ai: 1, type: 4 },
                { name: "eight_tail", nick: "nari", element: "no", ai: 2, type: 2 },
                { name: "fire_bishop", nick: "vishuvac", element: "fire", ai: 3, type: 1 },
                { name: "plitvice", nick: "plitvice", element: "fire", ai: 1, type: 1 },
                { name: "sheep_girl", nick: "rey", element: "fire", ai: 2, type: 1 },
                { name: "fire_harpy", nick: "scintilla", element: "fire", ai: 1, type: 1 },
                { name: "flower_girl", nick: "bari", element: "ground", ai: 2, type: 2 },
                { name: "idol_captain", nick: "eva", element: "no", ai: 1, type: 3 },
                { name: "cyborg_monk", nick: "qianlv", element: "light", ai: 2, type: 2 },
                { name: "succubus_noble", nick: "bianca", element: "water", ai: 2, type: 2 },
            ],
            checker: [
                //土盾系列
                { name: "盾索狼鱼", party: ["craig", "lupina", "sohee", "sia"] },
                { name: "盾索狼鬼", party: ["craig", "lupina", "sohee", "karina"] },
                { name: "盾刀狼鱼", party: ["craig", "lupina", "beth", "sia"] },
                { name: "盾刀狼鬼", party: ["craig", "lupina", "beth", "karina"] },
                { name: "刀盾狼鬼", party: ["beth", "lupina", "craig", "karina"] },
                { name: "盾暗萝", party: ["craig", "lupina", "karina", "noxia"] },
                { name: "盾姐刀", party: ["craig", "*", "parvati", "beth"] },
                { name: "盾安吉", party: ["craig", "*", "angie", "*"] },
                { name: "盾姐索", party: ["craig", "*", "parvati", "sohee"] },
                //暗刀系列
                { name: "刀盾姐鱼", party: ["beth", "craig", "parvati", "sia"] },
                { name: "刀姐", party: ["beth", "*", "parvati", "*"] },
                //艾草系列
                { name: "艾土", party: ["estel", "craig", "yuna", "eunha"] },
                { name: "艾仙土", party: ["estel", "craig", "dabin", "*"] },
                //纯土系列
                { name: "盾控纯土", party: ["craig", "dabin", "ameris", "kamael"] },
                { name: "仙控纯土", party: ["dabin", "craig", "ameris", "kamael"] },
                //仙瑜系列
                { name: "经典仙瑜", party: ["dabin", "craig", "yuna", "eunha"] },
                { name: "盾控仙瑜", party: ["craig", "dabin", "yuna", "eunha"] },
                { name: "仙女-炮", party: ["dabin", "craig", "yuna", "mk99"] },
                { name: "仙女-其他", party: ["dabin", "craig", "yuna", "*"] },
                //公主系列
                { name: "公索狼登", party: ["fprincess", "sohee", "lupina", "kaden"] },
                { name: "公索狼骑", party: ["fprincess", "sohee", "lupina", "knight"] },
                { name: "公狼刀", party: ["fprincess", "*", "beth", "lupina"] },
                { name: "公狼姐", party: ["fprincess", "*", "beth", "parvati"] ,without:["kaden"]},
                { name: "公姐登", party: ["fprincess", "*", "parvati", "kaden"] },
                //火魔系列
                { name: "火刀狼", party: ["paimond", "*", "beth", "lupina"] },
                { name: "火姐刀", party: ["paimond", "*", "beth", "parvati"] },
                { name: "火姐瑜", party: ["paimond", "*", "yuna", "parvati"] },
                //鬼系列
                { name: "鬼土盾", party: ["karina", "craig", "*", "*"] },
                { name: "鬼姐", party: ["karina", "parvati", "*", "craig"] },
                { name: "鬼双射", party: ["karina", "*", "eunha", "craig"] },
                { name: "鬼双切", party: ["karina", "parvati", "beth", "craig"] },
                { name: "鬼炮", party: ["karina", "craig", "mk99", "camilla"] },
                //暗狼系列
                { name: "狼控", party: ["lupina", "craig", "*", "*"] },
                //技伤系列
                { name: "土盾技伤", party: ["craig", "eunha", "coco", "*"] },
                { name: "土盾三奶", party: ["craig", "sia", "miya", "*"] },
                //银河系列
                { name: "银河技伤", party: ["eunha", "veronica", "craig", "miya"] },
                { name: "银河光", party: ["eunha", "mk99", "craig", "camilla"] },
                { name: "银河双光", party: ["eunha", "gabriel", "craig", "eleanor"] },
                { name: "银河水炮", party: ["eunha", "bianca", "mk99", "craig"] },
                //投胎系列
                { name: "索投", party: ["sohee", "*", "*", "*"] },
                { name: "臀投", party: ["valencia", "*", "*", "*"] },
                { name: "登投", party: ["kaden", "*", "*", "*"] },
                { name: "kai投", party: ["kai", "*", "*", "*"] },
                { name: "骑投", party: ["knight", "*", "*", "*"] },
                { name: "刀投1", party: ["beth", "lupina", "*", "*"] },
                { name: "刀投2", party: ["beth", "kaden", "*", "*"] },
                //其他队伍
                { name: "莉娜", party: ["lina", "*", "*", "*"] },
                { name: "老纯土", party: ["mayreel", "craig", "rue", "kamael"] },
                { name: "老纯光", party: ["fprincess", "gabriel", "eleanor", "mk99"] },
                { name: "土盾三辅", party: ["craig", "kamael", "noxia", "karina"] },
                { name: "公主双坦", party: ["fprincess", "craig", "*", "*"] },
                { name: "土盾双射", party: ["craig", "karina", "camilla", "*"] },
                { name: "土盾双射-光炮", party: ["craig", "karina", "camilla", "mk99"] },
                { name: "土盾双射-银河", party: ["craig", "karina", "camilla", "eunha"] },
                //辅助匹配
                { name: "土盾鱼", party: ["craig", "sia", "*", "*"] },
                { name: "公主姐", party: ["fprincess", "parvati", "*", "*"] },
            ],
            solution: [
                //merch: 1 熊猫 3 坦杀 2 售货机 4 双子 5 母舰
                //card: 1 防 3 爆 5 7 攻

                //奶系列
                {
                    name: "瑜奶", party: [{ nick: "craig", merch: 1 }, { nick: "sia", merch: 2 }, { nick: "miya", merch: 2 }, { nick: "yuna", merch: 2 }],
                    card: [[1, 1], [10, 4], [10, 4], [10, 10]],
                    solve: [
                        { name: "盾刀狼鬼" },
                        { name: "盾索狼鱼" },
                    ]
                },
                {
                    name: "菜奶", party: [{ nick: "craig", merch: 1 }, { nick: "sia", merch: 2 }, { nick: "miya", merch: 2 }, { nick: "shuna", merch: 2 }],
                    card: [[1, 1], [10, 4], [10, 4], [10, 10]],
                    solve: [
                        { name: "盾刀狼鬼" },
                        { name: "盾刀狼鱼" },
                    ]
                },
                {
                    name: "双t奶", party: [{ nick: "fprincess", merch: 1 }, { nick: "miya", merch: 2 }, { nick: "craig", merch: 1 }, { nick: "yuna", merch: 2 }],
                    card: [[1, 4], [10, 10], [1, 4], [10, 10]],
                    solve: [
                        { name: "公索狼登" },
                        { name: "公索狼骑" },
                        { name: "公狼刀" },
                    ]
                },
                //土三暗
                {
                    name: "土三暗", party: [{ nick: "craig", merch: 1 }, { nick: "lupina" }, { nick: "beth", merch: 1 }, { nick: "karina" }],
                    card: [[1, 1], [3, 7], [3, 3], [7, 1]],
                    solve: [
                        { name: "土盾技伤" },
                        { name: "土盾安吉" },
                        { name: "银河技伤", merch: [1, 5, 1, 1] },
                        { name: "银河水炮", merch: [1, 5, 1, 1] },
                        { name: "土盾双射", merch: [1, 3, 3, 3] },
                    ],
                },
                {
                    name: "土三暗-贝丝", party: [{ nick: "beth", merch: 1  }, { nick: "craig" , merch: 1 }, { nick: "lupina", merch: 1  }, { nick: "karina", merch: 1  }],
                    card: [[3, 3], [1, 1], [3, 7], [7, 1]],
                    solve: [
                        { name: "土盾双射-银河", merch: [3, 1, 3, 3] },
                        { name: "艾土"},
                    ],
                },
                {
                    name: "土三暗-狼", party: [{ nick: "lupina" }, { nick: "craig" }, { nick: "beth" }, { nick: "karina" }],
                    card: [[3, 3], [1, 1], [3, 7], [7, 1]],
                    solve: [
                        { name: "刀投2", merch: [3, 1, 3, 3] }],
                },
                {
                    name: "土三暗-鬼", party: [{ nick: "karina" }, { nick: "craig" }, { nick: "beth" }, { nick: "lupina" }],
                    card: [[7, 1], [1, 1], [3, 7], [3, 3]],
                    solve: [
                        { name: "土盾技伤", merch: [3, 1, 3, 3] },
                    ],
                },
                //鬼系列
                {
                    name: "鬼奶", party: [{ nick: "karina", merch: 3 }, { nick: "craig", merch: 1 }, { nick: "parvati", merch: 1 }, { nick: "miya", merch: 2 },],
                    card: [[3, 3], [1, 1], [3, 7], [1, 1]],
                    solve: [
                        { name: "公主双坦" },
                        { name: "土盾三辅" },
                        { name: "土盾三奶" },
                        { name: "盾索狼鱼" },
                        { name: "盾索狼鬼" }
                    ],
                },
                {
                    name: "鬼爆", party: [{ nick: "karina", merch: 3 }, { nick: "craig", merch: 1 }, { nick: "parvati", merch: 1 }, { nick: "eunha", merch: 2 },],
                    card: [[3, 3], [1, 1], [3, 7], [1, 1]],
                    solve: [
                        { name: "刀盾姐鱼" },
                        { name: "盾索狼鱼" },
                        { name: "盾索狼鬼" },
                        { name: "狼控" },
                    ],
                },
                {
                    name: "鬼双t", party: [{ nick: "karina", merch: 4 }, { nick: "eunha", merch: 2 }, { nick: "craig", merch: 1 }, { nick: "fprincess", merch: 1 },],
                    card: [[3, 3], [10, 10], [1, 4], [1, 4]],
                    solve: [
                        { name: "公索狼登" }
                    ],
                },
                {
                    name: "鬼远", party: [{ nick: "karina", merch: 3 }, { nick: "claude", merch: 1 }, { nick: "camilla", merch: 1 }, { nick: "craig", merch: 1 },],
                    card: [[3, 3], [1, 1], [3, 7], [1, 1]],
                    solve: [
                        { name: "公刀姐" },
                        { name: "火姐刀" },
                    ],
                },
                {
                    name: "鬼爪", party: [{ nick: "karina", merch: 4 }, { nick: "craig", merch: 1 }, { nick: "vishuvac", merch: 1 }, { nick: "eunha", merch: 3 },],
                    card: [[3, 3], [1, 1], [1, 1], [1, 1]],
                    solve: [
                        { name: "经典仙瑜" },
                        { name: "盾控仙瑜" },
                        { name: "仙瑜-其他" },
                        { name: "艾土" },
                        { name: "艾仙土" },
                    ],
                },
                {
                    name: "鬼梯度上升", party: [{ nick: "karina", merch: 3 }, { nick: "miya", merch: 2 }, { nick: "oghma", merch: 6 }, { nick: "craig_noshield", merch: 6 },],
                    card: [[10, 10], [10, 10], [1, 1], [1, 1]],
                    solve: [
                        { name: "火刀狼" },
                    ],
                },
                // 公主
                {
                    name: "公维", party: [{ nick: "fprincess", merch: 1 }, { nick: "lupina", merch: 5 }, { nick: "vinette", merch: 1 }, { nick: "beth", merch: 1 }],
                    card: [[1, 1], [3, 7], [1, 1], [3, 3]],
                    solve: [
                        { name: "盾索狼鱼" },
                        { name: "盾索狼鬼" },
                        { name: "登投" },
                        { name: "公索狼登" },
                        { name: "公刀狼" },
                        { name: "公索狼骑" }
                    ],
                },
                {
                    name: "公鱼", party: [{ nick: "fprincess", merch: 1 }, { nick: "lupina", merch: 5 }, { nick: "sia", merch: 1 }, { nick: "beth", merch: 1 }],
                    card: [[1, 1], [3, 7], [1, 1], [3, 3]],
                    solve: [
                        { name: "盾索狼鱼" },
                        { name: "盾索狼鬼" },
                    ],
                },
                {
                    name: "公沄", party: [{ nick: "fprincess", merch: 1 }, { nick: "yun", merch: 5 }, { nick: "fknight", merch: 1 }, { nick: "craig", merch: 1 }],
                    card: [[1, 4], [3, 3], [1, 7], [1, 4]],
                    solve: [
                        { name: "公索狼骑" },
                        { name: "公索狼登" },
                    ],
                },
                {
                    name: "公瑜", party: [{ nick: "fprincess", merch: 1 }, { nick: "lupina", merch: 5 }, { nick: "yuna", merch: 1 }, { nick: "beth", merch: 1 }],
                    card: [[1, 1], [3, 7], [1, 1], [3, 3]],
                    solve: [
                        { name: "盾索狼鱼" },
                        { name: "盾索狼鬼" },
                        { name: "登投" },
                        { name: "公索狼登" },
                        { name: "公刀狼" },
                        { name: "公索狼骑" }
                    ],
                },
                {
                    name: "公章饺", party: [{ nick: "fprincess", merch: 6 }, { nick: "eleanor", merch: 6 }, { nick: "veronica", merch: 6 }, { nick: "ara", merch: 6 }],
                    card: [[10, 10], [1, 1], [1, 1], [1, 1]],
                    solve: [
                        { name: "火姐瑜" },
                    ],
                },
                // 刀p
                {
                    name: "暗刀cd", party: [{ nick: "beth" }, { nick: "lupina", merch: 1 }, { nick: "oghma", merch: 1 }, { nick: "vinette", merch: 1 }],
                    card: [[3, 3], [3, 7], [1, 1], [1, 1]],
                    solve: [
                        { name: "盾索狼鱼", merch: [5, 4, 1, 1] },
                        { name: "盾索狼鬼", merch: [5, 4, 1, 1] },
                    ],
                },
                {
                    name: "暗刀cd-狼控", party: [{ nick: "lupina", merch: 1 }, { nick: "beth" }, { nick: "oghma", merch: 1 }, { nick: "vinette", merch: 1 }],
                    card: [[3, 7], [3, 3], [1, 1], [1, 1]],
                    solve: [
                        { name: "狼控" }
                    ],
                },
                // 光系
                {
                    name: "纯光", party: [{ nick: "fprincess", merch: 1 }, { nick: "eleanor", merch: 3 }, { nick: "mk99", merch: 4 }, { nick: "gabriel", merch: 1 }],
                    card: [[1, 1], [3, 1], [3, 3], [1, 1]],
                    solve: [
                        { name: "盾暗萝" },
                        { name: "莉娜" },
                        { name: "鬼双射" },
                        { name: "鬼炮" }
                    ],
                },
                {
                    name: "登光", party: [{ nick: "fprincess", merch: 1 }, { nick: "eleanor" }, { nick: "kai", merch: 1 }, { nick: "gabriel" }],
                    card: [[1, 1], [3, 4], [1, 1], [1, 4]],
                    solve: [
                        { name: "盾刀狼鬼", merch: [1, 3, 1, 3] },
                        { name: "盾刀狼鱼", merch: [1, 3, 1, 3] },
                    ],
                },
                {
                    name: "双t光", party: [{ nick: "fprincess", merch: 1 }, { nick: "eleanor", merch: 3 }, { nick: "craig", merch: 1 }, { nick: "gabriel", merch: 3 }],
                    card: [[1, 4], [3, 3], [1, 4], [3, 3]],
                    solve: [
                        { name: "盾刀狼鬼" },
                        { name: "盾刀狼鱼" },
                        { name: "登投" },
                        { name: "刀投1" },
                    ],
                },
                {
                    name: "公刀狼kai", party: [{ nick: "fprincess",merch:1 }, { nick: "lupina", merch: 5 }, { nick: "beth", merch: 1 }, { nick: "kai", merch: 1 }],
                    card: [[1, 1], [3, 7], [3, 3], [7, 1]],
                    solve: [
                        { name: "刀投1" },
                        { name: "登投" },
                        { name: "鬼双切", merch: [1, 5, 1, 1] },
                    ],
                },
                // 火魔系列
                {
                    name: "烧0", party: [{ nick: "paimond", merch: 1 }, { nick: "winling", merch: 1 }, { nick: "parvati", merch: 1 }, { nick: "beth", merch: 1 }],
                    card: [[1, 1], [1, 1], [3, 7], [3, 3]],
                    solve: [
                        { name: "土盾鱼" },
                        { name: "公姐" },
                    ],
                },
                // 投胎系列
                {
                    name: "姐投", party: [{ nick: "parvati", merch: 1 }, { nick: "lupina", merch: 1 }, { nick: "beth", merch: 1 }, { nick: "valencia", merch: 1 }],
                    card: [[7, 7], [1, 5], [7, 7], [1, 1]],
                    solve: [
                        { name: "鬼姐" },
                        { name: "鬼双射" }
                    ],
                },
                {
                    name: "臀投", party: [{ nick: "valencia", merch: 1 }, { nick: "lupina", merch: 1 }, { nick: "kai", merch: 1 }, { nick: "beth", merch: 1 }],
                    card: [[3, 3], [7, 1], [7, 1], [3, 7]],
                    solve: [
                        { name: "鬼土盾" },
                        { name: "鬼双射", march: [1, 5, 1, 1] },
                        { name: "鬼双切", march: [1, 5, 1, 1] },
                        { name: "土盾双射-光炮" },
                        { name: "土盾双射-银河" }
                    ],
                },
                {
                    name: "臀投2", party: [{ nick: "valencia", merch: 1 }, { nick: "parvati", merch: 1 }, { nick: "sohee", merch: 1 }, { nick: "kaden", merch: 1 }],
                    card: [[3, 3], [7, 1], [7, 1], [3, 7]],
                    solve: [
                        { name: "鬼土盾" },
                        { name: "鬼双射", march: [1, 5, 1, 1] },
                        { name: "鬼双切", march: [1, 5, 1, 1] },
                        { name: "土盾双射-光炮" },
                        { name: "土盾双射-银河" }
                    ],
                },
                {
                    name: "刀投", party: [{ nick: "beth", merch: 4 }, { nick: "lupina", merch: 4 }, { nick: "sohee", merch: 1 }, { nick: "kai", merch: 1 }],
                    card: [[3, 3], [7, 1], [3, 7], [7, 1]],
                    solve: [
                        { name: "银河光" }],
                },
                {
                    name: "刀kai", party: [{ nick: "beth", merch: 4 }, { nick: "lupina", merch: 4 }, { nick: "craig", merch: 1 }, { nick: "kai", merch: 1 }],
                    card: [[3, 3], [7, 1], [3, 7], [7, 1]],
                    solve: [
                        { name: "登投" }],
                },
                {
                    name: "索投", party: [{ nick: "sohee", merch: 4 }, { nick: "lupina", merch: 1 }, { nick: "beth", merch: 1 }, { nick: "kai", merch: 1 }],
                    card: [[3, 3], [7, 1], [3, 7], [7, 1]],
                    solve: [
                        { name: "莉娜" },
                        { name: "老纯光" },
                    ],
                },
                {
                    name: "登投", party: [{ nick: "kaden", merch: 1 }, { nick: "lupina", merch: 1 }, { nick: "beth", merch: 1 }, { nick: "karina", merch: 1 }],
                    card: [[7, 3], [3, 3], [3, 7], [1, 1]],
                    solve: [
                        { name: "经典仙瑜" }],
                },
                {
                    name: "火投", party: [{ nick: "rey", merch: 1 }, { nick: "winling", merch: 1 }, { nick: "saya", merch: 1 }, { nick: "vishuvac", merch: 1 }],
                    card: [[10, 10], [3, 3], [3, 7], [3, 3]],
                    solve: [
                        { name: "仙控纯土" },
                        { name: "盾控纯土" },
                    ],
                },
                // 反投系列
                {
                    name: "仙山拳", party: [{ nick: "fprincess", merch: 1 }, { nick: "fei", merch: 1, weapon: "china" }, { nick: "eleanor", merch: 4 }, { nick: "beth", merch: 1 }],
                    card: [[1, 1], [1, 1], [3, 4], [3, 3]],
                    solve: [
                        { name: "kai投" },
                        { name: "刀投" },
                        { name: "索投" },
                        { name: "臀投" }
                    ],
                },
                // 土系
                {
                    name: "银河土", party: [{ nick: "eunha", merch: 1 }, { nick: "ameris", merch: 1 }, { nick: "dabin", merch: 1 }, { nick: "craig", merch: 1 }],
                    card: [[10, 10], [3, 7], [3, 3], [1, 1]],
                    solve: [
                        { name: "公姐登" },
                    ],
                },
                {
                    name: "仙女土", party: [{ nick: "dabin", merch: 1 }, { nick: "craig", merch: 1 }, { nick: "ameris", merch: 1 }, { nick: "kamael", merch: 1 }],
                    card: [[3, 3], [1, 1], [7, 3], [3, 7]],
                    solve: [
                        { name: "刀姐" },
                    ],
                },
                {
                    name: "仙瑜土", party: [{ nick: "dabin", merch: 3 }, { nick: "yuna", merch: 1 }, { nick: "eunha", merch: 1 }, { nick: "craig", merch: 1 }],
                    card: [[3, 7], [10, 10], [3, 3], [1, 1]],
                    solve: [
                        { name: "火刀姐" },
                    ],
                },
            ],
            merchName: ["enhance_bond", "mad_panda_trophy", "vending_machine", "oghma_box", "twin_statue", "mothership_model", "princess_figure"],
            character: [],
            usedList: {},
            enemyParty: new Party(),
            calcParty: new Party(),
            isEnemyCs: 0,
            enemyCs: 0,
            showCalcParty: 0,
            elementFilter: "",
            characterBuffer: null,
            tileBuffer: null,
            arrowList: [],
        },
        computed: {

        },
        methods: {
            info(msg, flag) {
                if (flag === 0) {
                    this.succInfo = msg; this.errorInfo = "";
                } else {
                    this.errorInfo = msg; this.succInfo = "";
                }
            },
            init() {
                const enemyMap = new Array(boardHeight);
                for (let i = 0; i < boardHeight; ++i) {
                    enemyMap[i] = new Array(boardWidth);
                }
                const calcMap = new Array(boardHeight);
                for (let i = 0; i < boardHeight; ++i) {
                    calcMap[i] = new Array(boardWidth);
                }

                const character = [];
                for (let i = 0; i < this.character_.length; ++i) {
                    let item = this.character_[i];
                    if (item.weapon === undefined) {
                        item.weapon = item.name.replaceAll('_', '');
                    }
                    if (item.shield === undefined) {
                        item.shield = 0;
                    }
                    if (item.disable === undefined) {
                        item.disable = 0;
                    }
                    const c = new Character({ id: i, name: item.name, nick: item.nick, element: item.element, weapon: item.weapon, ai: item.ai, shield: item.shield, type: item.type, disable: item.disable });
                    character.push(c);
                }
                const elementFilters = [];
                for (let i = 0; i < this.elementFilters_.length; ++i) {
                    let item = this.elementFilters_[i];
                    const c = new ElementFilter({ id: i, name: item.name, color: item.color });
                    elementFilters.push(c);
                }
                const enemyList = [];
                for (let i = 0; i < boardHeight; ++i) {
                    for (let j = 0; j < boardWidth; ++j) {
                        const tile = new Tile({ side: 1, x: j, y: i, c: character[0] });
                        enemyMap[i][j] = tile;
                        enemyList.push(tile);
                    }
                }
                const calcList = [];
                for (let i = 0; i < boardHeight; ++i) {
                    for (let j = 0; j < boardWidth; ++j) {
                        const tile = new Tile({ side: 0, x: j, y: i, c: character[0] });
                        calcMap[i][j] = tile;
                        calcList.push(tile);
                    }
                }
                this.character = character;
                this.elementFilters = elementFilters;
                this.enemyMap = enemyMap;
                this.enemyList = enemyList;
                this.calcMap = calcMap;
                this.calcList = calcList;
                for (let i = 0; i < this.solution.length; ++i) {
                    for (let j = 0; j < this.solution[i].party.length; ++j) {
                        const nick = this.solution[i].party[j].nick;
                        for (let k = 0; k < this.character.length; ++k) {
                            if (this.character[k].nick === nick) {
                                this.solution[i].party[j].character = this.character[k];

                                let weapon_img = "./pic/item/weapon/centered_cwp_";
                                if (this.solution[i].party[j].weapon !== undefined) weapon_img = weapon_img + this.solution[i].party[j].weapon + ".png";
                                else weapon_img = weapon_img + this.character[k].weapon + ".png";

                                let merch_img = "./pic/item/merch/centered_merch_";
                                let merch = (this.solution[i].party[j].merch === undefined) ? 0 : this.solution[i].party[j].merch;

                                merch_img = merch_img + this.merchName[merch] + ".png";

                                const equipment = [{ style: {}, image: weapon_img }, { style: {}, image: merch_img }, { style: {}, image: "" }, { style: {}, image: "" }];
                                if (this.character[k].shield !== 0) {
                                    equipment.push({ style: {}, image: "./pic/item/shield/centered_goblin_chief_shield.png" });
                                }

                                this.solution[i].party[j].character.equipment = equipment;
                                break;
                            }
                        }
                        this.solution[i].party[j].style = { left: offset + j * width + "px", top: "0px" }
                        this.solution[i].party[j].card = this.solution[i].card[j];
                    }
                    for (let j = 0; j < this.solution[i].solve.length; ++j) {
                        if (this.solution[i].solve[j].merch === undefined) {
                            const tmp = [];
                            for (let k = 0; k < this.solution[i].party.length; ++k) {
                                let merch = (this.solution[i].party[k].merch === undefined) ? 0 : this.solution[i].party[k].merch;
                                tmp.push(merch);
                            }
                            this.solution[i].solve[j].merch = tmp;
                        }
                    }
                }
            },
            updateUsedList() {
                this.usedList = {};
                this.enemyParty.member = [];
                let fpos = -1;
                for (let i = 0, j = 0; i < this.enemyList.length; ++i) {
                    if (this.enemyList[i].character.id !== 0) {
                        this.usedList[this.enemyList[i].character.id] = this.enemyList[i];
                        this.enemyParty.addMember(this.enemyList[i].character, 1);
                        if (this.enemyParty.leader === null) this.enemyParty.leader = this.enemyList[i].character;
                        if (this.enemyParty.leader === this.enemyList[i].character) fpos = j;
                        j = j + 1;
                    }
                }
                if (fpos === -1) {
                    if (this.enemyParty.member.length === 0) this.enemyParty.leader = null;
                    else this.enemyParty.leader = this.enemyParty.member[0], fpos = 0;
                }
                if (this.enemyParty.leader !== null) {
                    const t = this.enemyParty.member[fpos];
                    this.enemyParty.member[fpos] = this.enemyParty.member[0];
                    this.enemyParty.member[0] = t;
                }
                this.enemyParty.refresh(1);
            },
            modifyEP(members, item) {
                let index = -1;
                for (let i = 0; i < members.length; ++i) {
                    if (members[i] === item) {
                        index = i; break;
                    }
                }
                if (index !== 0) {
                    const tmp = members[index - 1];
                    members[index - 1] = members[index];
                    members[index] = tmp;
                    this.enemyParty.leader = members[0];
                }
                this.enemyParty.member = members;
                this.enemyParty.refresh(1);
                this.refreshLocker();
            },
            distance(x1, y1, x2, y2) {
                return ((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));
            },
            refreshLocker() {
                const topList = [];
                for (let i = 0; i < 5; ++i) {
                    topList.push(offset + height * i + height / 2);
                }
                const leftList = [];
                for (let i = 0; i < 4; ++i) {
                    leftList.push(offset + width * i + width / 2);
                }
                for (let i = 0; i < 6; ++i) leftList.push(0);
                for (let i = 0; i < 4; ++i) {
                    leftList.push(enemyLeftOffset + offset + width * i + width / 2);
                }

                const clist = [];
                for (let i = 0; i < this.calcParty.member.length; ++i) {
                    for (let x = 0; x < this.calcMap.length; ++x) {
                        for (let y = 0; y < this.calcMap[x].length; ++y) {
                            if (this.calcMap[x][y].character === this.calcParty.member[i]) {
                                clist.push({ x: x, y: y, c: this.calcMap[x][y].character, locked: 0 });
                                break;
                            }
                        }
                    }
                }
                const elist = [];
                for (let i = 0; i < this.enemyParty.member.length; ++i) {
                    for (let x = 0; x < this.enemyMap.length; ++x) {
                        for (let y = 0; y < this.enemyMap[x].length; ++y) {
                            if (this.enemyMap[x][y].character === this.enemyParty.member[i]) {
                                elist.push({ x: x, y: y + 10, c: this.enemyMap[x][y].character, locked: 0 });
                                break;
                            }
                        }
                    }
                }
                for (let i = 0; i < clist.length; ++i) {
                    const c = clist[i];
                    let ai = c.c.ai;
                    switch (ai) {
                        case 0: break;
                        case 1: { // 近战 ai
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                if (e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                        case 2: { // 远程 ai
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                        case 3: { // 锁射手
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                if (e.c.type !== 2 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.c.type !== 2) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                        case 4: { // 锁辅助
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                if (e.c.type !== 3 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.c.type !== 3) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                        case 4: { // 锁战士
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                if (e.c.type !== 1 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.c.type !== 1) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                        case 5: { // 支援
                            let maxx = 0;
                            let maxi = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                if (i === j) continue;
                                const e = clist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis > maxx) {
                                    maxx = dis; maxi = j;
                                }
                            }
                            clist[i].to = clist[maxi];
                            if (maxi === -1) break;
                            clist[maxi].locked = 1;
                            break;
                        }
                        case 6: { // 暗萝
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            clist.push({ x: c.x, y: c.y, c: new Character({ id: 999, name: "golem", nick: "golem", ai: 1, type: 4, element: "dark" }), locked: 0 });
                            break;
                        }
                        case 7: { // 火奶
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < elist.length; ++j) {
                                const e = elist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (e.locked && dis >= 65) continue;
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < elist.length; ++j) {
                                    const e = elist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            clist[i].to = elist[mini];
                            if (mini === -1) break;
                            elist[mini].locked = 1;
                            break;
                        }
                    }
                }
                for (let i = 0; i < elist.length; ++i) {
                    const c = elist[i];
                    let ai = c.c.ai;
                    switch (ai) {
                        case 0: break;
                        case 1: { // 近战 ai
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                if (e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            break;
                        }
                        case 2: { // 远程 ai
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            break;
                        }
                        case 3: { // 锁射手
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                if (e.c.type !== 2 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.c.type !== 2) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            break;
                        }
                        case 5: {
                            break;
                        }
                        case 4: { // 锁辅助
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                if (e.c.type !== 3 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.c.type !== 3) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            break;
                        }
                        case 8: { // 锁战士
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                if (e.c.type !== 1 || e.locked) continue;
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.c.type !== 1) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    if (e.locked) continue;
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            break;
                        }
                        case 6: { // 暗萝
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            elist[i].to = clist[mini];
                            if (mini === -1) break;
                            clist[mini].locked = 1;
                            elist.push({ x: c.x, y: c.y, c: new Character({ id: 999, name: "golem", nick: "golem", ai: 1, type: 4, element: "dark" }), locked: 0 });
                            break;
                        }
                        case 7: { // 火奶
                            let minx = 10000;
                            let mini = -1;
                            for (let j = 0; j < clist.length; ++j) {
                                const e = clist[j];
                                let dis = this.distance(c.x, c.y, e.x, e.y);
                                if (e.locked && dis >= 65) continue;
                                if (dis < minx) {
                                    minx = dis; mini = j;
                                }
                            }
                            if (mini === -1) {
                                for (let j = 0; j < clist.length; ++j) {
                                    const e = clist[j];
                                    let dis = this.distance(c.x, c.y, e.x, e.y);
                                    if (dis < minx) {
                                        minx = dis; mini = j;
                                    }
                                }
                            }
                            if (mini === -1) break;
                            elist[i].to = clist[mini];
                            clist[mini].locked = 1;
                            break;
                        }
                    }
                }
                const arrowList = [];
                for (let i = 0; i < clist.length; ++i) {
                    const c = clist[i];
                    const e = clist[i].to;
                    if (e === undefined) continue;
                    const arrow = {
                        x1: topList[c.x] - 3,
                        y1: leftList[c.y],
                        x2: topList[e.x] - 3,
                        y2: leftList[e.y],
                        style: "stroke:rgb(0,210,212);stroke-width:3",
                    }
                    arrowList.push(arrow);
                }
                for (let i = 0; i < elist.length; ++i) {
                    const c = elist[i];
                    const e = elist[i].to;
                    if (e === undefined) continue;
                    const arrow = {
                        x1: topList[c.x] + 3,
                        y1: leftList[c.y],
                        x2: topList[e.x] + 3,
                        y2: leftList[e.y],
                        style: "stroke:rgb(190,21,21);stroke-width:3",
                    }
                    arrowList.push(arrow);
                }
                this.arrowList = arrowList;
            },
            modifyCP(members, item) {
                let index = -1;
                for (let i = 0; i < members.length; ++i) {
                    if (members[i] === item) {
                        index = i; break;
                    }
                }
                if (index > 1) {
                    const tmp = members[index - 1];
                    members[index - 1] = members[index];
                    members[index] = tmp;
                    for (let i = 0; i < members[index - 1].equipment.length; ++i) {
                        members[index - 1].equipment[i].style.left = offset + i * width;
                    }
                    for (let i = 0; i < members[index].equipment.length; ++i) {
                        members[index].equipment[i].style.left = offset + i * width;
                    }
                }
                this.calcParty.member = members;
                this.calcParty.refresh(0);
                this.refreshLocker();
            },
            updateFilter(banned) {
                for (let i = 0, id = 0; i < this.character.length; ++i) {
                    id = id + this.character[i].filter({ ban: banned, element: this.elementFilter }, id);
                }
            },
            clickCard(item) {
                this.showSolution = 0;
                this.updateUsedList();
                if (this.isEnemyCs === 1) {
                    this.enemyCs.style.opacity = 1;
                    if (this.enemyCs === item) {
                        this.enemyCs.setCharacter(this.character[0]);
                        this.isEnemyCs = 0;
                        this.updateUsedList();
                        this.updateFilter(1);
                        this.refreshLocker();
                        return;
                    }
                }
                this.isEnemyCs = 1;
                this.enemyCs = item;
                this.enemyCs.style.opacity = 0.5;
                this.updateUsedList();
                this.updateFilter(0);
                this.refreshLocker();
            },
            clickECs(item) {
                this.showSolution = 0;
                if (this.usedList.hasOwnProperty(item.id)) {
                    this.usedList[item.id].setCharacter(this.character[0]);
                } else {
                    if (this.enemyParty.member.length >= 4 && item.id !== 0 && this.enemyCs.character.id === 0) {
                        this.info("队伍已满员！", 1);
                        return;
                    }
                }
                this.enemyCs.setCharacter(item);
                this.enemyCs.style.opacity = 1;
                this.isEnemyCs = 0;
                this.updateUsedList();
                this.updateFilter(1);
                this.refreshLocker();
            },
            clickElementFilter(item) {
                this.showSolution = 0;
                if (this.elementFilter === item.name) this.elementFilter = "", item.style.opacity = 1;
                else {
                    for (let i = 0; i < this.elementFilters.length; ++i) {
                        this.elementFilters[i].style.opacity = 1;
                    }
                    this.elementFilter = item.name, item.style.opacity = 0.5;
                }
                this.updateFilter(0);
                this.refreshLocker();
            },
            check(party, checker) {
                const cparty = checker.party;
                if (cparty.length === 0) {
                    return 0;//to do SPJ
                }
                if (party[0].nick !== cparty[0]) return 0;
                for (let i = 1; i < 4; ++i) {
                    if (cparty[i] === "*") continue;
                    let flag = 0;
                    for (let j = 1; j < 4; ++j) {
                        if (cparty[i] === party[j].nick) {
                            flag = 1;
                            break;
                        }
                    }
                    if (flag === 0) return 0;
                }
                if (checker.without !== undefined) {
                    for (let i = 1; i < 4; ++i) {
                        for (let j = 0; j < checker.without.length; ++j) {
                            if (checker.without[j] === party[i].nick) return 0;
                        }
                    }
                }
                return 1;
            },
            chooseCalc(item) {
                this.calcParty.member = [];
                this.calcParty.leader = null;
                for (let i = 0; i < this.calcList.length; ++i) {
                    this.calcList[i].setCharacter(this.character[0], 0);
                }
                for (let i = 0; i < item.party.length; ++i) {
                    for (let j = 0; j < item.party[i].character.equipment.length; ++j) {
                        item.party[i].character.equipment[j].style = {
                            left: offset + i * width + "px",
                            top: offset + (7 + j) * height + "px",
                        }
                    }
                    let merch_img = "./pic/item/merch/centered_merch_";
                    let merch = (item.party[i].merch === undefined) ? 0 : item.party[i].merch;
                    merch_img = merch_img + this.merchName[merch] + ".png";
                    item.party[i].character.equipment[1].image = merch_img;
                    if (i === 0 && item.party[0].character.shield === 1) {
                        if (item.party[0].character.id === this.enemyParty.member[0].id || item.party[0].character.nick === "fprincess") {
                            item.party[0].character.equipment[4].image = "./pic/item/shield/centered_mirror_shield.png";
                        }
                    }

                    let orb_img0 = "./pic/item/orb/centered_orb_";
                    let orb0 = item.party[i].card[0];
                    orb_img0 = orb_img0 + orb0 + ".png";

                    let orb_img1 = "./pic/item/orb/centered_orb_";
                    let orb1 = item.party[i].card[1];
                    orb_img1 = orb_img1 + orb1 + ".png";

                    let len = item.party[i].character.equipment.length;
                    item.party[i].character.equipment[2].image = orb_img0;
                    item.party[i].character.equipment[3].image = orb_img1;


                    this.calcParty.addMember(item.party[i].character, 0);
                    this.calcParty.member[i].calcStyle.opacity = 1;
                }
                this.tileBuffer = null;
                this.characterBuffer = null;
                this.showCalcParty = 1;
                this.calcParty.refresh(0);
                this.calcParty.leader = this.calcParty.member[0];
                this.showSolution = 0;
                this.refreshLocker();
            },
            clickCalc(item) {
                if (item.character.id === 0) {
                    if (this.characterBuffer === null) return;
                    if (this.characterBuffer.id !== 0) {
                        item.setCharacter(this.characterBuffer, 0);
                        this.characterBuffer.calcStyle.opacity = 0.25;
                        this.characterBuffer = null;
                        if (this.tileBuffer !== null) {
                            this.tileBuffer.setCharacter(this.character[0], 0);
                            this.tileBuffer.style.opacity = 1;
                            this.tileBuffer = null;
                        }
                    }
                } else {
                    if (this.characterBuffer === null) {
                        this.characterBuffer = item.character;
                        item.style.opacity = 0.5;
                        this.tileBuffer = item;
                    } else if (this.characterBuffer.id === item.character.id) {
                        item.style.opacity = 1;
                        item.setCharacter(this.character[0], 0);
                        this.characterBuffer.calcStyle.opacity = 1;
                        this.characterBuffer = null;
                        this.tileBuffer = null;
                    } else if (this.tileBuffer !== null) {
                        this.tileBuffer.style.opacity = 1;
                        item.style.opacity = 1;
                        const tmp = this.tileBuffer.character;
                        this.tileBuffer.setCharacter(item.character, 0);
                        item.setCharacter(tmp, 0);
                        this.tileBuffer = null;
                        this.characterBuffer = null;
                    }
                }
                this.refreshLocker();
            },
            clickSP(item) {
                if (item.calcStyle.opacity === 0.25) return;
                if (this.characterBuffer !== null) {
                    this.characterBuffer.calcStyle.opacity = 1;
                }
                item.calcStyle.opacity = 0.5;
                this.characterBuffer = item;
                this.refreshLocker();
            },
            calc() {
                if (this.enemyParty.member.length !== 4) {
                    this.info("队伍角色数不是四名！", 1);
                    return;
                } else {
                    this.errorInfo = "";
                }
                const partyType = [];
                for (let i = 0; i < this.checker.length; ++i) {
                    const checker = this.checker[i];
                    if (this.check(this.enemyParty.member, checker)) {
                        partyType.push(checker.name);
                    }
                }
                const solutions = [];
                for (let i = 0; i < this.solution.length; ++i) {
                    let flag = 0;
                    let index = 0;
                    const solution = this.solution[i];
                    for (let j = 0; j < partyType.length; ++j) {
                        for (let k = 0; k < solution.solve.length; ++k) {
                            const solve = solution.solve[k];
                            if (partyType[j] === solve.name) {
                                flag = 1;
                                index = k;
                            }
                        }
                    }
                    if (flag === 1) {
                        for (let j = 0; j < solution.party.length; ++j) {
                            if (solution.solve[index].merch[j] !== undefined) solution.party[j].merch = solution.solve[index].merch[j];
                            solution.party[j].style.top = offset + (solutions.length + 7) * height + "px";
                        }
                        solutions.push(solution);
                    }
                }
                this.solutions = solutions;
                if (this.solutions.length === 0) {
                    this.info("未找到合适解", 1);
                } else {
                    this.showSolution = 1;
                    this.info("计算完成", 0);
                }
                this.refreshLocker();
            },
            resetEnemy() {
                const enemyMap = new Array(boardHeight);
                for (let i = 0; i < boardHeight; ++i) {
                    enemyMap[i] = new Array(boardWidth);
                }
                const enemyList = [];
                for (let i = 0; i < boardHeight; ++i) {
                    for (let j = 0; j < boardWidth; ++j) {
                        const tile = new Tile({ side: 1, x: j, y: i, c: this.character[0] });
                        enemyMap[i][j] = tile;
                        enemyList.push(tile);
                    }
                }
                this.enemyList = enemyList;
                this.enemyMap = enemyMap;
                this.updateUsedList();
                this.refreshLocker();
            },
        },
        mounted: function () {
            this.init();
        },
    });
</script>
<style>
    .main {
        position: relative;
    }

    .enemyList {
        position: absolute;
    }

    .enemy {
        position: relative;
    }

    .enemyCs {
        position: relative;
    }

    .enemyCsList {
        position: absolute;
    }

    .elementFilter {
        position: absolute;
    }

    .enemyParty {
        position: absolute;
    }

    .calcParty {
        position: absolute;
    }

    .calcList {
        position: absolute;
    }

    .solutions {
        position: absolute;
    }

    .equipment {
        position: absolute;
    }

    .arrow {
        pointer-events: none;
        position: absolute;
        z-index: 1;
    }

    .calcButton {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        width: 120px;
        z-index: 0;
    }
</style>

</html>